<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>متجر إلكتروني هادئ وأنيق</title>
<style>
:root{
  --primary: #3b82f6;
  --primary-dark: #2563eb;
  --secondary: #fff;
  --background: #fff;
  --text-main: #000;
  --muted: #888;
  --danger: #ef4444; /* أحمر */
  --success: #25D366; /* أخضر واتساب */
  --card: #fff;
  --border: #e5e7eb;
  --active-bg: #f6f6f6; /* خلفية رمادية فاتحة للعنصر النشط */
  --control-border: #111; /* أسود */
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Tahoma,Arial,Helvetica,sans-serif;
  background:var(--background);
  color:var(--text-main);
}
header{
  position:sticky; top:0; z-index:120;
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 16px;
  background: var(--secondary);
}
.logo .title{ color:var(--text-main); font-weight:900; }
nav{
  display:flex; gap:12px; align-items:center; position:relative;
  min-height:50px;
  background: var(--secondary);
  border-bottom: 2.5px solid var(--border);
}
nav a{
  text-decoration:none;
  color:var(--text-main);
  padding:7px 16px;
  border-radius:11px;
  font-weight:700;
  cursor:pointer;
  background:none;
  position:relative;
  transition:background 0.19s, color 0.18s, border 0.19s;
  border:2.7px solid transparent;
}
nav a.active{
  background:var(--active-bg);
  color:var(--text-main);
  border:2.7px solid var(--danger); /* إطار أحمر حول القسم النشط */
}
nav a:not(.active):hover{background:var(--active-bg);}
nav a:not(.active){color:var(--text-main);}
main{ padding:14px; max-width:960px; margin:0 auto 100px auto; color:var(--text-main);}
.section-title{ margin:6px 0 12px; font-size:16px; font-weight:700; color:var(--text-main);}
.grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(152px,1fr)); gap:14px;}
.card{
  background:var(--card);
  border-radius:12px;
  padding:12px;
  border:1.5px solid var(--border);
  position:relative; overflow:visible; text-align:center;
  color:var(--text-main);
}
.card h4{margin:7px 0 4px;font-size:13px;color:var(--text-main);}
.card p.desc{font-size:10px;color:var(--muted);min-height:32px;}
.card p.price{color:var(--danger);font-weight:800;margin:6px 0;}
.card .add-btn{
  background:var(--primary);
  color:#fff;
  border:0;padding:6px 10px;border-radius:8px;cursor:pointer;
  font-weight:800;font-size:12px;
  transition:background 0.18s;
}
.card .add-btn:hover{background:var(--primary-dark);}
.badge-new{
  position:absolute;top:7px;left:7px;
  background:transparent;
  color:var(--danger); /* كلمة NEW باللون الأحمر */
  padding:4px 6px;
  border-radius:6px;
  font-weight:800;font-size:10px;
  border:1px solid var(--danger);
}
.order-sticker{
  position:fixed;
  left:18px;
  bottom:22px;
  width:65px;height:65px;
  background:var(--secondary);
  border-radius:15px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  border:2px solid var(--border);
  cursor:pointer;
  color:var(--text-main);
  box-shadow:0 2px 12px rgba(0,0,0,0.07);
}
.order-sticker .icon{font-size:22px; color:var(--text-main);}
.order-sticker .label{font-size:12px;color:var(--text-main);font-weight:900;margin-top:4px;}
.sticker-count{
  position:absolute;
  top:8px;right:8px;
  background:var(--danger);
  color:#fff;
  font-size:10px;
  padding:4px 6px;
  border-radius:999px;
  display:none;
  font-weight:900;
}
.cart-side{
  position:fixed;left:0;top:0;height:100vh;width:0;overflow:hidden;z-index:600;
  background:var(--secondary);
  border-top-right-radius:14px;border-bottom-right-radius:14px;transition:width 0.28s;display:flex;flex-direction:column;
  border-right:2px solid var(--primary);
  color:var(--text-main);
}
.cart-side.open{width:304px;}
.cart-side .head{padding:12px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);}
.cart-side .title{font-weight:900;font-size:15px;color:var(--text-main);}
.cart-side .close-btn{background:transparent;border:none;font-size:18px;cursor:pointer;color:var(--danger);}
.cart-side .head-controls{display:flex;align-items:center;gap:10px;}
.cart-side .total-row{font-size:13px;color:var(--text-main);} /* السعر الإجمالي بالأسود */
.cart-side .buy-btn{
  background:var(--success); /* أخضر واتساب */
  color:#fff;border:none;padding:7px 10px;border-radius:8px;font-weight:900;cursor:pointer;
  font-size:12px;
  transition:background 0.18s;
  position:relative;
  box-shadow: 0 3px 8px #25d3662b;
}
.cart-side .buy-btn.blink{
  animation: blinkBtn 0.7s alternate infinite;
}
@keyframes blinkBtn {
  0% {box-shadow:0 0 0 0px var(--danger);}
  60% {box-shadow:0 0 0 14px var(--danger);}
  100% {box-shadow:0 0 0 0px var(--danger);}
}
.buy-btn-indicator {
  position: absolute;
  top: -12px;
  right: 10px;
  width: 11px;
  height: 11px;
  background: var(--danger);
  border-radius: 50%;
  box-shadow: 0 0 6px #ef444455;
  border:1.5px solid #fff;
  display: none;
  z-index: 2;
}
.cart-side .buy-btn:hover{background:#1bb954;}
.cart-side .content{padding:10px;flex:1;overflow:auto;}
.cart-side .item{display:flex;gap:9px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);}
.cart-side .item img{width:48px;height:48px;object-fit:cover;border-radius:6px;}
.cart-side .meta{text-align:right;flex:1;}
.cart-side .meta .name{font-weight:800;font-size:12px;color:var(--text-main);}
.cart-side .meta .sub{color:var(--muted);font-size:10px;margin-top:4px;}
.cart-side .qty{display:flex;gap:6px;align-items:center;}
.cart-side .qty button{background:#eee;border:none;padding:4px 6px;border-radius:6px;cursor:pointer;color:var(--primary-dark);}
.cart-side .qty button:hover{background:var(--primary);color:#fff;}
.cart-side .remove-btn{background:var(--danger);color:#fff;border:none;padding:4px 6px;border-radius:6px;cursor:pointer;font-size:11px;}
.cart-side .footer{padding:15px 10px;border-top:1px solid var(--border);display:flex;flex-direction:column;gap:8px;align-items:stretch;}
.admin-list{margin-top:9px;max-height:192px;overflow:auto;border-top:1px solid var(--border);padding-top:6px;color:var(--text-main);}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:900;padding:14px;}
.panel{
  width:496px;max-width:100%;
  background:var(--card);
  padding:12px;
  border-radius:10px;
  border:2.7px solid var(--control-border); /* إطار أسود للوحة التحكم */
}
.form-row{display:flex;gap:7px;flex-wrap:wrap;margin-top:7px;}
input[type="text"], input[type="number"], input[type="password"], textarea, select{padding:7px;border-radius:7px;border:1px solid var(--border);flex:1;font-size:13px;color:var(--text-main);}
.small-btn{background:var(--primary);color:#fff;padding:6px 9px;border-radius:8px;border:none;cursor:pointer;font-weight:700;font-size:12px;}
.small-btn:hover{background:var(--danger);}
.img-viewer{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:1200;}
.img-viewer .box{
  max-width:72%;
  max-height:72%;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}
.img-viewer img{
  max-width:100%;
  max-height:70vh;
  border-radius:6px;
  background:#fff;
  transition: opacity 0.35s, transform 0.33s;
  opacity: 1;
  transform: scale(1);
}
.img-viewer img.fade {
  opacity: 0.15;
  transform: scale(0.96);
}
.img-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: 999px;
  width: 38px;
  height: 38px;
  font-size: 22px;
  cursor: pointer;
  opacity: 0.93;
  z-index: 10;
  transition: background 0.18s, opacity 0.18s;
}
.img-arrow:hover {
  background: var(--primary-dark);
  opacity: 1;
}
.img-arrow.left { left: -24px; }
.img-arrow.right { right: -24px; }
.center{display:flex;align-items:center;justify-content:center;}

/* مؤشر التحميل */
.loading-indicator {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.9);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  flex-direction: column;
  gap: 10px;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--border);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  color: var(--text-main);
  font-weight: 600;
  font-size: 14px;
}

/* رسائل الحالة */
.status-message {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 12px 16px;
  border-radius: 8px;
  color: #fff;
  font-weight: 600;
  z-index: 10000;
  max-width: 300px;
  transform: translateX(100%);
  transition: transform 0.3s ease;
}

.status-message.show {
  transform: translateX(0);
}

.status-message.success {
  background: var(--success);
}

.status-message.error {
  background: var(--danger);
}

@media (max-width:860px){
  .grid{grid-template-columns:repeat(auto-fill,minmax(120px,1fr));}
  .cart-side.open{width:78%;}
  .panel{width:90%;}
  .img-arrow.left { left: -8px;}
  .img-arrow.right { right: -8px;}
}
@media (max-width:420px){
  .card .main-img{height:110px;}
  .thumb{width:28px;height:20px;}
  .img-arrow.left { left: 0;}
  .img-arrow.right { right: 0;}
}
</style>
</head>
<body>

<!-- مؤشر التحميل -->
<div class="loading-indicator" id="loadingIndicator">
  <div class="loading-spinner"></div>
  <div class="loading-text">جاري التحميل...</div>
</div>

<header>
  <div style="display:flex;gap:8px;align-items:center;">
    <div class="logo" title="المتجر">
      <div class="title">متجر<br>الكتروني</div>
    </div>
  </div>
  <nav>
    <a id="nav-home" href="#home" class="active">الرئيسية</a>
    <a id="nav-offers" href="#offers">العروض</a>
    <a id="nav-admin" href="#control">لوحة التحكم</a>
  </nav>
</header>

<main>
  <section id="home" style="display:block">
    <h2 class="section-title">المنتجات</h2>
    <div id="productsGrid" class="grid"></div>
  </section>
  <section id="offers" style="display:none">
    <h2 class="section-title">العروض</h2>
    <div id="offersGrid" class="grid"></div>
  </section>
</main>

<div class="order-sticker" id="orderSticker" title="عرض السلة">
  <div class="sticker-count" id="stickerCount">0</div>
  <div class="icon">🛒</div>
  <div class="label">السلة</div>
</div>

<div class="cart-side" id="cartSide" aria-hidden="true">
  <div class="head">
    <div class="head-controls">
      <div class="title">سلة المشتريات</div>
      <div class="total-row">
        <span>الإجمالي:</span>
        <span id="sideTotalHead">0.00 ريال عماني</span>
      </div>
      <button class="buy-btn" id="buyBtn">اطلب الآن عبر واتساب
        <span class="buy-btn-indicator" id="buyBtnIndicator"></span>
      </button>
    </div>
    <div><button class="close-btn" id="closeCartBtn" aria-label="إغلاق">✖</button></div>
  </div>
  <div class="content" id="sideContent">
    <div id="sideItems"></div>
  </div>
  <div class="footer"></div>
</div>

<div class="img-viewer" id="imgViewer" role="dialog" aria-hidden="true">
  <div class="box center" style="position:relative;">
    <button id="viewerPrev" class="img-arrow left" aria-label="السابق">&#8592;</button>
    <img id="viewerImg" src="" alt="صورة أكبر">
    <button id="viewerNext" class="img-arrow right" aria-label="التالي">&#8594;</button>
    <button id="viewerClose" style="position:absolute; top:14px; left:14px; background:#fff;border-radius:6px;padding:4px 6px; cursor:pointer; font-size:18px;">✖</button>
  </div>
</div>

<div class="modal" id="adminModal" style="display:none;">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div style="font-weight:900;font-size:15px;color:var(--text-main);">لوحة التحكم</div>
      <div><button class="small-btn" onclick="closeAdmin()">✖</button></div>
    </div>
    <div id="loginPanel" class="form-row" style="margin-top:14px;">
      <input id="adminPass" type="password" placeholder="أدخل كلمة المرور">
      <button class="small-btn" onclick="adminLogin()">دخول</button>
    </div>
    <div id="controlPanel" style="display:none; margin-top:9px;">
      <div class="form-row">
        <input id="prodName" placeholder="اسم المنتج">
        <input id="prodPrice" type="number" placeholder="السعر">
      </div>
      <div class="form-row">
        <input id="prodImages" placeholder="روابط الصور مفصولة بفاصلة (حتى 10 روابط)">
      </div>
      <div class="form-row">
        <textarea id="prodDesc" placeholder="الوصف (اختياري)"></textarea>
      </div>
      <div class="form-row">
        <select id="prodType">
          <option value="normal">رئيسية</option>
          <option value="offer">عرض</option>
        </select>
        <button class="small-btn" onclick="addProduct()">إضافة</button>
      </div>
      <div style="margin-top:9px;color:var(--text-main);"><strong>المنتجات الحالية</strong></div>
      <div class="admin-list" id="adminList"></div>
    </div>
  </div>
</div>

<!-- Supabase JavaScript Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- تطبيق JavaScript الرئيسي -->
<script src="app.js"></script>

</body>
</html>
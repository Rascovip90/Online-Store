<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ù†Ù‡Ø§Ø¦ÙŠ</title>
<style>
:root{
  --accent:#ff7a18;
  --dark:#222;
  --card:#ffffff;
  --muted:#6b7280;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#ffffff;
  color:#111;
}
header{
  position:sticky; top:0; z-index:120;
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.98));
  box-shadow: 0 6px 18px rgba(2,6,23,0.04);
}
.logo{display:flex; align-items:center; gap:8px; font-weight:800; font-size:15px;}
.logo .title{ color:#000; font-weight:900; line-height:1.05; text-align:right; }
nav{display:flex; gap:10px; align-items:center;}
nav a{ text-decoration:none; color:#111827; padding:7px 8px; border-radius:8px; font-weight:700; cursor:pointer;}
nav a.active{ color:var(--accent); }
main{ padding:14px; max-width:960px; margin:0 auto 100px auto; }
.section-title{ margin:6px 0 12px; font-size:16px; font-weight:700; color:#0f172a; }
.grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(190px,1fr)); gap:14px;}
.card{
  background:var(--card);
  border-radius:10px;
  padding:10px;
  box-shadow:0 6px 18px rgba(2,6,23,0.04);
  position:relative; overflow:visible; text-align:center;
}
.gallery{position:relative;}
.main-img{width:100%;height:122px;object-fit:cover;border-radius:8px;cursor:pointer;}
.thumbs{display:flex;gap:6px;justify-content:center;margin-top:6px;}
.thumb{width:44px;height:34px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent;}
.thumb.active{border-color:var(--accent);}
.card h4{margin:7px 0 4px;font-size:13px;color:#0f172a;}
.card p.desc{font-size:10px;color:#444;min-height:32px;}
.card p.price{color:var(--accent);font-weight:800;margin:6px 0;}
.card .add-btn{background:linear-gradient(90deg,var(--accent),#ff9b4a);color:#fff;border:0;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:800;font-size:12px;}
.badge-new{position:absolute;top:7px;left:7px;background:var(--accent);color:#fff;padding:4px 6px;border-radius:6px;font-weight:800;font-size:10px;}
.order-sticker{position:fixed;left:16px;bottom:16px;width:70px;height:70px;background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(255,255,255,0.96));border-radius:13px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 12px 32px rgba(2,6,23,0.08);z-index:520;}
.order-sticker .icon{font-size:18px;}
.order-sticker .label{font-size:10px;color:#0f172a;font-weight:800;margin-top:4px;}
.sticker-count{position:absolute;top:6px;right:6px;background:#ef4444;color:#fff;font-size:10px;padding:4px 6px;border-radius:999px;box-shadow:0 8px 20px rgba(239,68,68,0.12);display:none;}
.cart-side{position:fixed;left:0;top:0;height:100vh;width:0;overflow:hidden;z-index:600;background:linear-gradient(180deg,rgba(255,255,255,0.99),rgba(255,255,255,0.98));box-shadow:8px 0 40px rgba(2,6,23,0.08);border-top-right-radius:14px;border-bottom-right-radius:14px;transition:width 0.28s cubic-bezier(.2,.9,.2,1);display:flex;flex-direction:column;}
.cart-side.open{width:304px;}
.cart-side .head{padding:12px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #f1f5f9;}
.cart-side .title{font-weight:900;font-size:14px;color:#0f172a;}
.cart-side .close-btn{background:transparent;border:none;font-size:16px;cursor:pointer;color:#0f172a;}
.cart-side .head-controls{display:flex;align-items:center;gap:10px;}
.cart-side .total-row{font-size:13px;}
.cart-side .buy-btn{background:#25d366;color:#fff;border:none;padding:7px 10px;border-radius:8px;font-weight:900;cursor:pointer;box-shadow:0 8px 20px rgba(37,211,102,0.12);font-size:12px;}
.cart-side .content{padding:10px;flex:1;overflow:auto;}
.cart-side .item{display:flex;gap:9px;align-items:center;padding:8px 0;border-bottom:1px solid #f1f5f9;}
.cart-side .item img{width:48px;height:48px;object-fit:cover;border-radius:6px;}
.cart-side .meta{text-align:right;flex:1;}
.cart-side .meta .name{font-weight:800;font-size:12px;}
.cart-side .meta .sub{color:var(--muted);font-size:10px;margin-top:4px;}
.cart-side .qty{display:flex;gap:6px;align-items:center;}
.cart-side .qty button{background:#f3f4f6;border:none;padding:4px 6px;border-radius:6px;cursor:pointer;}
.cart-side .remove-btn{background:#ef4444;color:#fff;border:none;padding:4px 6px;border-radius:6px;cursor:pointer;font-size:11px;}
.cart-side .footer{padding:15px 10px;border-top:1px solid #f1f5f9;display:flex;flex-direction:column;gap:8px;align-items:stretch;}
.admin-list{margin-top:9px;max-height:192px;overflow:auto;border-top:1px solid #f1f5f9;padding-top:6px;}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.4);z-index:900;padding:14px;}
.panel{width:496px;max-width:100%;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 14px 48px rgba(2,6,23,0.12);}
.form-row{display:flex;gap:7px;flex-wrap:wrap;margin-top:7px;}
input[type="text"], input[type="number"], textarea, select{padding:7px;border-radius:7px;border:1px solid #e6e9ee;flex:1;font-size:13px;}
.small-btn{background:#111827;color:#fff;padding:6px 9px;border-radius:8px;border:none;cursor:pointer;font-weight:700;font-size:12px;}
.img-viewer{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1200;}
.img-viewer .box{max-width:72%;max-height:72%;display:flex;gap:9px;align-items:center;justify-content:center;}
.img-viewer img{max-width:100%;max-height:70vh;border-radius:6px;box-shadow:0 7px 28px rgba(0,0,0,0.6);}
.center{display:flex;align-items:center;justify-content:center;}
@media (max-width:860px){.grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));}.cart-side.open{width:78%;}.panel{width:90%;}}
@media (max-width:420px){.card .main-img{height:160px;}.thumb{width:36px;height:29px;}
}
</style>
</head>
<body>

<header>
  <div style="display:flex;gap:8px;align-items:center;">
    <div class="logo" title="Ø§Ù„Ù…ØªØ¬Ø±">
      <div class="title">Ù…ØªØ¬Ø±<br>Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
    </div>
  </div>
  <nav>
    <a id="nav-home" href="#home" class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a id="nav-offers" href="#offers">Ø§Ù„Ø¹Ø±ÙˆØ¶</a>
    <a id="nav-admin" href="#control">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <div id="cartTopBtn" style="margin-left:10px;font-weight:800;color:#0f172a;cursor:pointer;">ğŸ›’ <span id="top-count">0</span></div>
  </nav>
</header>

<main>
  <section id="home" style="display:block">
    <h2 class="section-title">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <div id="productsGrid" class="grid"></div>
  </section>
  <section id="offers" style="display:none">
    <h2 class="section-title">Ø§Ù„Ø¹Ø±ÙˆØ¶</h2>
    <div id="offersGrid" class="grid"></div>
  </section>
</main>

<div class="order-sticker" id="orderSticker" title="Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©">
  <div class="sticker-count" id="stickerCount">0</div>
  <div class="icon">ğŸ›’</div>
  <div class="label">Ø§Ù„Ø³Ù„Ø©</div>
</div>

<div class="cart-side" id="cartSide" aria-hidden="true">
  <div class="head">
    <div class="head-controls">
      <div class="title">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
      <div class="total-row">
        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
        <span id="sideTotalHead">0.00 Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</span>
      </div>
      <button class="buy-btn" id="buyBtn">ğŸŸ¢ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>
    <div><button class="close-btn" id="closeCartBtn" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ–</button></div>
  </div>
  <div class="content" id="sideContent">
    <div id="sideItems"></div>
  </div>
  <div class="footer">
    <!-- Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ùˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‡Ù†Ø§ -->
  </div>
</div>

<div class="img-viewer" id="imgViewer" role="dialog" aria-hidden="true">
  <div class="box center">
    <button id="viewerPrev" style="background:transparent;border:none;color:#fff;font-size:22px;cursor:pointer;margin-right:6px">â—€</button>
    <img id="viewerImg" src="" alt="ØµÙˆØ±Ø© Ø£ÙƒØ¨Ø±">
    <button id="viewerNext" style="background:transparent;border:none;color:#fff;font-size:22px;cursor:pointer;margin-left:6px">â–¶</button>
    <button id="viewerClose" style="position:absolute; top:14px; left:14px; background:#fff;border-radius:6px;padding:4px 6px; cursor:pointer;">âœ–</button>
  </div>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙƒÙ†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© ÙÙ‚Ø· -->
<div class="modal" id="adminModal" style="display:none;">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div style="font-weight:900;font-size:15px">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
      <div><button class="small-btn" onclick="closeAdmin()">âœ–</button></div>
    </div>
    <div id="loginPanel" class="form-row" style="margin-top:14px;">
      <input id="adminPass" type="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button class="small-btn" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„</button>
    </div>
    <div id="controlPanel" style="display:none; margin-top:9px;">
      <div class="form-row">
        <input id="prodName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input id="prodPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
      </div>
      <div class="form-row">
        <input id="prodImages" placeholder="Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø© (Ø­ØªÙ‰ 4 Ø±ÙˆØ§Ø¨Ø·)">
      </div>
      <div class="form-row">
        <textarea id="prodDesc" placeholder="Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
      </div>
      <div class="form-row">
        <select id="prodType">
          <option value="normal">Ø±Ø¦ÙŠØ³ÙŠØ©</option>
          <option value="offer">Ø¹Ø±Ø¶</option>
        </select>
        <button class="small-btn" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
      <div style="margin-top:9px"><strong>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</strong></div>
      <div class="admin-list" id="adminList"></div>
    </div>
  </div>
</div>

<script>
const PRODUCTS_KEY = 'my_products_v3';
const CART_KEY = 'my_cart_v3';
const ADMIN_PASS = '7732';
let products = JSON.parse(localStorage.getItem(PRODUCTS_KEY) || '[]');
let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
const productsGrid = document.getElementById('productsGrid');
const offersGrid = document.getElementById('offersGrid');
const orderSticker = document.getElementById('orderSticker');
const stickerCountEl = document.getElementById('stickerCount');
const cartSide = document.getElementById('cartSide');
const sideItems = document.getElementById('sideItems');
const adminModal = document.getElementById('adminModal');
const loginPanel = document.getElementById('loginPanel');
const controlPanel = document.getElementById('controlPanel');
const adminListDiv = document.getElementById('adminList');
const imgViewer = document.getElementById('imgViewer');
const viewerImg = document.getElementById('viewerImg');
const viewerPrev = document.getElementById('viewerPrev');
const viewerNext = document.getElementById('viewerNext');
const viewerClose = document.getElementById('viewerClose');
function saveProducts(){localStorage.setItem(PRODUCTS_KEY,JSON.stringify(products));}
function saveCart(){localStorage.setItem(CART_KEY,JSON.stringify(cart));}
function formatCurrency(v){return Number(v).toFixed(2);}
function escapeHtml(s){if(!s && s!==0)return '';return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
function renderProducts(){productsGrid.innerHTML='';const now=Date.now();products.filter(p=>p.type==='normal').forEach(p=>{const card=document.createElement('div');card.className='card';const imgs=Array.isArray(p.images)?p.images.slice(0,4):[];const main=imgs[0]||'';card.innerHTML=`<div class="gallery">${(now-p.dateAdded<24*60*60*1000)?'<div class="badge-new">NEW</div>':''}<img src="${escapeHtml(main)}" class="main-img" alt="${escapeHtml(p.name)}" data-id="${p.id}" data-index="0"><div class="thumbs">${imgs.map((u,i)=>`<img src="${escapeHtml(u)}" class="thumb ${i===0?'active':''}" data-id="${p.id}" data-index="${i}" alt="thumb">`).join('')}</div></div><h4>${escapeHtml(p.name)}</h4><p class="desc">${escapeHtml(p.desc||'')}</p><p class="price">${formatCurrency(p.price)} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</p><button class="add-btn" onclick="addToCartById(${p.id})">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>`;productsGrid.appendChild(card);});attachGalleryHandlers();}
function renderOffers(){offersGrid.innerHTML='';const now=Date.now();products.filter(p=>p.type==='offer').forEach(p=>{const card=document.createElement('div');card.className='card';const imgs=Array.isArray(p.images)?p.images.slice(0,4):[];const main=imgs[0]||'';card.innerHTML=`<div class="gallery">${(now-p.dateAdded<24*60*60*1000)?'<div class="badge-new">NEW</div>':''}<img src="${escapeHtml(main)}" class="main-img" alt="${escapeHtml(p.name)}" data-id="${p.id}" data-index="0"><div class="thumbs">${imgs.map((u,i)=>`<img src="${escapeHtml(u)}" class="thumb ${i===0?'active':''}" data-id="${p.id}" data-index="${i}" alt="thumb">`).join('')}</div></div><h4>${escapeHtml(p.name)}</h4><p class="desc">${escapeHtml(p.desc||'')}</p><p class="price">${formatCurrency(p.price)} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</p><button class="add-btn" onclick="addToCartById(${p.id})">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>`;offersGrid.appendChild(card);});attachGalleryHandlers();}
function attachGalleryHandlers(){document.querySelectorAll('.thumb').forEach(t=>{t.addEventListener('click',function(){const card=this.closest('.card');const main=card.querySelector('.main-img');main.src=this.src;card.querySelectorAll('.thumb').forEach(x=>x.classList.remove('active'));this.classList.add('active');main.dataset.index=this.dataset.index;});});document.querySelectorAll('.main-img').forEach(m=>{m.addEventListener('click',function(){const id=Number(this.dataset.id);const prod=products.find(p=>p.id===id);if(!prod)return;const imgs=Array.isArray(prod.images)&&prod.images.length?prod.images:[''];let start=Number(this.dataset.index||0);openViewer(imgs,start);});});}
let viewerImgs=[];let viewerIndex=0;
function openViewer(imgs,startIndex=0){viewerImgs=imgs;viewerIndex=startIndex||0;viewerImg.src=viewerImgs[viewerIndex]||'';imgViewer.style.display='flex';imgViewer.setAttribute('aria-hidden','false');}
function closeViewer(){imgViewer.style.display='none';imgViewer.setAttribute('aria-hidden','true');}
viewerPrev.addEventListener('click',()=>{if(viewerImgs.length===0)return;viewerIndex=(viewerIndex-1+viewerImgs.length)%viewerImgs.length;viewerImg.src=viewerImgs[viewerIndex];});
viewerNext.addEventListener('click',()=>{if(viewerImgs.length===0)return;viewerIndex=(viewerIndex+1)%viewerImgs.length;viewerImg.src=viewerImgs[viewerIndex];});
viewerClose.addEventListener('click',closeViewer);
imgViewer.addEventListener('click',e=>{if(e.target===imgViewer)closeViewer();});
function addToCartById(id){const product=products.find(p=>p.id===id);if(!product)return;const existing=cart.find(c=>c.id===id);if(existing)existing.qty+=1;else cart.push({id:product.id,qty:1});saveCart();renderCartViews();updateSticker(true);}
function updateQty(id,delta){const item=cart.find(c=>c.id===id);if(!item)return;item.qty+=delta;if(item.qty<=0)cart=cart.filter(c=>c.id!==id);saveCart();renderCartViews();}
function removeFromCart(id){cart=cart.filter(c=>c.id!==id);saveCart();renderCartViews();}
function renderCartViews(){
  sideItems.innerHTML = '';
  let total = 0;
  cart.forEach(ci=>{
    const p = products.find(x=>x.id===ci.id);
    if(!p) return;
    total += p.price * ci.qty;
    const item = document.createElement('div'); item.className='item';
    const imgSrc = (Array.isArray(p.images) && p.images.length) ? p.images[0] : '';
    item.innerHTML = `
      <img src="${escapeHtml(imgSrc)}" alt="${escapeHtml(p.name)}">
      <div class="meta">
        <div class="name">${escapeHtml(p.name)}</div>
        <div class="sub">${formatCurrency(p.price)} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ Ã— ${ci.qty}</div>
      </div>
      <div class="qty">
        <button onclick="updateQty(${p.id},-1)">-</button>
        <span style="min-width:18px;text-align:center">${ci.qty}</span>
        <button onclick="updateQty(${p.id},+1)">+</button>
      </div>
      <div style="margin-left:6px"><button class="remove-btn" onclick="removeFromCart(${p.id})">Ø­Ø°Ù</button></div>
    `;
    sideItems.appendChild(item);
  });
  document.getElementById('sideTotalHead').textContent = formatCurrency(total) + ' Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ';
  const count = cart.reduce((s,i)=>s+i.qty,0);
  stickerCountEl.textContent = count;
  stickerCountEl.style.display = count ? 'block' : 'none';
  document.getElementById('top-count').textContent = count;
}
function updateSticker(on){
  const c = cart.reduce((s,i)=>s+i.qty,0);
  document.getElementById('top-count').textContent = c;
  stickerCountEl.textContent = c;
  stickerCountEl.style.display = c ? 'block' : 'none';
}
function openSideCart(){cartSide.classList.add('open');cartSide.setAttribute('aria-hidden','false');updateSticker(false);}
function closeSideCart(){cartSide.classList.remove('open');cartSide.setAttribute('aria-hidden','true');}
document.getElementById('closeCartBtn').addEventListener('click',()=>closeSideCart());
document.getElementById('cartTopBtn').addEventListener('click',()=>openSideCart());
orderSticker.addEventListener('click',()=>openSideCart());
document.getElementById('nav-admin').addEventListener('click',function(e){
  e.preventDefault();
  document.getElementById('adminModal').style.display = 'flex';
});
function openAdminModal(){
  adminModal.style.display='flex';
  loginPanel.style.display=sessionStorage.getItem('adminAuth')==='true'?'none':'flex';
  controlPanel.style.display=sessionStorage.getItem('adminAuth')==='true'?'block':'none';
  document.getElementById('adminPass').value='';
}
function closeAdmin(){adminModal.style.display='none';}
function adminLogin(){const pass=document.getElementById('adminPass').value;if(pass===ADMIN_PASS){sessionStorage.setItem('adminAuth','true');loginPanel.style.display='none';controlPanel.style.display='block';loadAdminList();}else{alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');}}
function loadAdminList(){adminListDiv.innerHTML='';products.forEach(p=>{const row=document.createElement('div');row.className='admin-item';row.style.display='flex';row.style.justifyContent='space-between';row.style.alignItems='center';row.style.padding='6px 0';row.innerHTML=`<div style="max-width:70%"><strong>${escapeHtml(p.name)}</strong><br><small style="color:#666">${escapeHtml(p.desc||'')}</small></div><div style="display:flex;gap:6px"><button class="small-btn" onclick="editProduct(${p.id})">ØªØ¹Ø¯ÙŠÙ„</button><button style="background:#ef4444;color:#fff;padding:6px 7px;border-radius:8px;border:0;cursor:pointer;font-size:11px;" onclick="deleteProduct(${p.id})">Ø­Ø°Ù</button></div>`;adminListDiv.appendChild(row);});}
function addProduct(){const name=document.getElementById('prodName').value.trim();const price=parseFloat(document.getElementById('prodPrice').value);const imagesRaw=document.getElementById('prodImages').value.trim();const desc=document.getElementById('prodDesc').value.trim();const type=document.getElementById('prodType').value;if(!name||!imagesRaw||isNaN(price)){alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ØµÙˆØ± (Ø±ÙˆØ§Ø¨Ø·) ÙˆØ§Ù„Ø³Ø¹Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');return;}const imgs=imagesRaw.split(',').map(s=>s.trim()).filter(s=>s).slice(0,4);const newP={id:Date.now(),name,price,images:imgs,desc,type,dateAdded:Date.now()};products.push(newP);saveProducts();renderProducts();renderOffers();loadAdminList();document.getElementById('prodName').value='';document.getElementById('prodPrice').value='';document.getElementById('prodImages').value='';document.getElementById('prodDesc').value='';}
function editProduct(id){const p=products.find(x=>x.id===id);if(!p)return;sessionStorage.setItem('adminAuth','true');loginPanel.style.display='none';controlPanel.style.display='block';document.getElementById('prodName').value=p.name;document.getElementById('prodPrice').value=p.price;document.getElementById('prodImages').value=Array.isArray(p.images)?p.images.join(', '):'';document.getElementById('prodDesc').value=p.desc||'';document.getElementById('prodType').value=p.type||'normal';deleteProduct(id);}
function deleteProduct(id){if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ'))return;products=products.filter(p=>p.id!==id);cart=cart.filter(c=>c.id!==id);saveProducts();saveCart();renderProducts();renderOffers();renderCartViews();loadAdminList();}
function showSection(sec){document.getElementById('home').style.display='none';document.getElementById('offers').style.display='none';document.querySelectorAll('nav a').forEach(a=>a.classList.remove('active'));if(sec==='home'){document.getElementById('home').style.display='block';document.getElementById('nav-home').classList.add('active');window.location.hash='#home';}else if(sec==='offers'){document.getElementById('offers').style.display='block';document.getElementById('nav-offers').classList.add('active');window.location.hash='#offers';}}
document.getElementById('nav-home').addEventListener('click',()=>showSection('home'));
document.getElementById('nav-offers').addEventListener('click',()=>showSection('offers'));
function initSectionFromHash(){
  const h = window.location.hash || '#home';
  if(h === '#offers') showSection('offers');
  else showSection('home');
}
window.addEventListener('hashchange',initSectionFromHash);
(function init(){cart=cart.filter(ci=>products.some(p=>p.id===ci.id));saveCart();renderProducts();renderOffers();renderCartViews();initSectionFromHash();updateSticker(false);})();

document.getElementById('buyBtn').addEventListener('click', function(){
  if(cart.length === 0){ alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return; }
  let text = "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£ÙˆØ¯ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡:\n";
  text += "---------------------\n";
  text += "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:\n";
  let total = 0;
  cart.forEach((ci, idx) => {
    const p = products.find(x => x.id === ci.id);
    if(!p) return;
    text += `${idx + 1}. ${p.name} Ã— ${ci.qty} = ${formatCurrency(p.price * ci.qty)} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ\n`;
    total += p.price * ci.qty;
  });
  text += "---------------------\n";
  text += `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${formatCurrency(total)} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ\n\n`;
  text += "ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù„Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±. Ø´ÙƒØ±Ù‹Ø§ Ù„ÙƒÙ…!";
  window.open(`https://wa.me/77324648?text=${encodeURIComponent(text)}`, '_blank');
});

document.addEventListener('keydown',function(e){
  if(e.key==='Escape'){
    if(imgViewer.style.display==='flex')closeViewer();
    if(adminModal.style.display==='flex')closeAdmin();
  }
});
</script>

</body>
</html>